---
# Test playbook for jtcom_config module.
#
# Run (dry-run):
#   cd ansible && OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES VIRTUAL_ENV=../.venv \
#     ANSIBLE_CONFIG=ansible.cfg ../.venv/bin/ansible-playbook -i inventory.ini \
#     test_playbook.yml -e jtcom_host=192.0.2.1 -e jtcom_user=admin \
#     -e jtcom_pass=admin --check
#
# Run (live apply):
#   (same without --check)

- hosts: local
  connection: local
  gather_facts: false
  vars:
    # Use the project venv so napalm-jtcom is importable by the module.
    ansible_python_interpreter: "{{ lookup('env', 'VIRTUAL_ENV') }}/bin/python3"

  tasks:
    - name: Configure JTCom switch VLANs
      jtcom_config:
        host: "{{ jtcom_host }}"
        username: "{{ jtcom_user }}"
        password: "{{ jtcom_pass }}"
        backup_before_change: true
        safety_port_id: 6
        vlans:
          223:
            name: Test_VLAN
            state: present
      register: result

    - name: Show result
      ansible.builtin.debug:
        var: result
