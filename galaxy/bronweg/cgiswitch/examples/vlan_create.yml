---
- name: Create VLANs on JTCom switch
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    switch_host: 192.0.2.1
    switch_user: "{{ lookup('env', 'SWITCH_USER') | default('admin') }}"
    switch_pass: "{{ lookup('env', 'SWITCH_PASS') }}"

  tasks:
    - name: Ensure VLAN 10 and 20 exist
      bronweg.cgiswitch.jtcom_config:
        host: "{{ switch_host }}"
        username: "{{ switch_user }}"
        password: "{{ switch_pass }}"
        verify_tls: false
        vlans:
          10:
            name: Management
            untagged_ports: [0]
          20:
            name: Data
            tagged_ports: [7]
            untagged_ports: [1, 2, 3]
